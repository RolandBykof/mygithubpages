<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lähtöselvitys - Paikan valinta - HuliviliAir</title>
    <style>
        /* HUOMIO: Tämä on esittelyversio, joka demonstroi Tab-navigoinnin toimintaa.
        Tuotantokoodissa tulisi huomioida: täydellinen virheenkäsittely, 
        backend-integraatio, laajempi selaintestaus ja kattava saavutettavuustestaus.
        */

        /* --- PERUSASETUKSET --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Alkuperäiset värit */
            --primary-color: #0066cc;     /* Valittu tausta */
            --primary-dark: #004080;      /* Valittu reunus */
            --bg-color: #f5f5f5;
            --text-color: #1a1a1a;
            
            /* Vapaa */
            --available-bg: #d4edda;
            --available-border: #28a745;
            --available-text: #155724;

            /* Varattu */
            --occupied-bg: #f8d7da;
            --occupied-border: #c92a2a;
            --occupied-text: #721c24;

            /* Hätärivi */
            --exit-bg: #fff3cd;
            --exit-border: #ffc107;
            --exit-text: #856404;

            /* Fokus */
            --focus-ring: 3px solid #ffd700;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            font-size: 16px;
        }

        /* Skip-linkki näppäimistökäyttäjille */
        .skip-link {
            position: absolute;
            top: -50px;
            left: 0;
            background: #000;
            color: #fff;
            padding: 1rem;
            z-index: 100;
            text-decoration: none;
            font-weight: bold;
            transition: top 0.2s;
        }
        .skip-link:focus { top: 0; outline: 4px solid #ffd700; }

        /* Yläpalkki */
        header {
            background-color: #1a4d7a;
            color: white;
            padding: 1.5rem;
            text-align: center;
        }

        main {
            max-width: 1000px;
            margin: 0 auto;
            padding: 1rem;
        }

        h1 { margin-bottom: 0.5rem; }
        h2 { color: #1a4d7a; margin: 1.5rem 0 1rem; }

        /* --- SELITTEET --- */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sample-seat {
            width: 35px;
            height: 35px;
            border: 3px solid #4a5568;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }

        /* Värit selitteisiin */
        .sample-seat.available { background: var(--available-bg); border-color: var(--available-border); color: var(--available-text); }
        .sample-seat.occupied { background: var(--occupied-bg); border-color: var(--occupied-border); color: var(--occupied-text); }
        .sample-seat.selected { background: var(--primary-color); border-color: var(--primary-dark); color: white; }
        .sample-seat.exit { background: var(--exit-bg); border-color: var(--exit-border); color: var(--exit-text); }

        /* --- PAIKKAKARTAN ASETTELU --- */
        .seat-map-container {
            overflow-x: auto;
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Käytämme CSS Gridiä visuaaliseen asetteluun, mutta emme ARIA Grid -roolia */
        .airplane-grid {
            display: grid;
            /* Rivi-numero | A B C | Käytävä | D E F */
            grid-template-columns: 40px repeat(3, minmax(44px, 60px)) 30px repeat(3, minmax(44px, 60px));
            gap: 10px;
            justify-content: center;
            min-width: 400px;
        }

        .row-number {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1a4d7a;
        }

        .grid-header {
            font-weight: bold;
            text-align: center;
            padding-bottom: 0.5rem;
            color: #1a4d7a;
        }

        /* --- PAIKKAPAINIKKEET --- */
        .seat-btn {
            width: 100%;
            /* Neliömäisyys ja minimikoko */
            aspect-ratio: 1; 
            min-height: 44px; /* Apple iOS minimisuositus */
            
            border: 3px solid #4a5568;
            border-radius: 4px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            
            /* Tärkeää mobiilille: estää kaksoisnapautus-zoomin viiveen */
            touch-action: manipulation;
        }

        /* Fokus-tyylit */
        .seat-btn:focus {
            outline: none;
            /* Musta reuna + kultainen hehku */
            box-shadow: 0 0 0 2px #000, 0 0 0 5px #ffd700; 
            z-index: 10;
        }

        /* Tilat ja värit */
        .seat-btn.available {
            background-color: var(--available-bg);
            border-color: var(--available-border);
            color: var(--available-text);
        }
        .seat-btn.available:hover {
            transform: scale(1.05);
            background-color: #c3e6cb;
        }

        .seat-btn.occupied {
            background-color: var(--occupied-bg);
            border-color: var(--occupied-border);
            color: var(--occupied-text);
            cursor: not-allowed;
            opacity: 0.9;
        }

        .seat-btn.exit {
            background-color: var(--exit-bg);
            border-color: var(--exit-border);
            color: var(--exit-text);
        }

        .seat-btn.selected {
            background-color: var(--primary-color);
            border-color: var(--primary-dark);
            color: white;
            border-width: 4px;
        }

        /* --- ALAPALKKI --- */
        .controls {
            margin-top: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            border-left: 6px solid var(--primary-color);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 1rem;
        }
        .btn-primary:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: var(--primary-dark);
        }

        .status-box {
            font-size: 1.1rem;
            font-weight: bold;
            min-height: 1.5em;
            color: #1a4d7a;
        }
    </style>
</head>
<body>

<a href="#seat-group" class="skip-link">Siirry suoraan paikkakarttaan</a>

<header>
    <h1>Lähtöselvitys - Paikan valinta</h1>
    <p>Lento HA123 Helsinki-Oulu | 24.11.2025 klo 14:30</p>
</header>

<main>
    <div class="instructions">
        <h2>Ohjeet</h2>
        <p>Valitse haluamasi paikka alla olevasta kartasta.</p>
        <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
            <li><strong>Ruudunlukijat:</strong> Käytä Tab-näppäintä tai nuolinäppäimiä liikkumiseen. Paina Enter tai välilyönti valitaksesi paikan.</li>
            <li><strong>Värit:</strong> Vihreä = Vapaa, Punainen = Varattu, Keltainen = Hätäpoistumisrivi, Sininen = Valittu.</li>
        </ul>
        
        <div class="legend" aria-hidden="true">
            <div class="legend-item"><div class="sample-seat available">A</div> Vapaa</div>
            <div class="legend-item"><div class="sample-seat selected">✓</div> Valittu</div>
            <div class="legend-item"><div class="sample-seat occupied">✕</div> Varattu</div>
            <div class="legend-item"><div class="sample-seat exit">⚠</div> Hätäpoistumisrivi</div>
        </div>
    </div>

    <section aria-labelledby="map-heading">
        <h2 id="map-heading">Paikkakartta</h2>
        
        <div id="selection-status" class="status-box" role="status" aria-live="polite">
            Ei valittua paikkaa.
        </div>

        <div class="seat-map-container">
            <div id="seat-group" class="airplane-grid" role="group" aria-label="Lentokoneen paikkakartta">
                </div>
        </div>
    </section>

    <div class="controls">
        <h2 id="confirmation-heading">Vahvistus</h2>
        <div id="selected-seat-display">Olet valinnut paikan: <span id="current-seat-text">-</span></div>
        
        <div style="margin-top: 1rem;">
            <button id="confirm-btn" class="btn-primary" disabled>Vahvista paikka</button>
            <button class="btn-primary" style="background-color: #6c757d; margin-left: 1rem;" onclick="location.reload()">Tyhjennä valinta</button>
        </div>
    </div>

</main>

<script>
    // --- KONFIGURAATIO ---
    const totalRows = 20;
    const occupiedSeats = ['1A', '1B', '2C', '3D', '5A', '7B', '7C', '8E', '10A', '10F', '12B', '15C', '15D', '18A'];
    const exitRows = [12, 13];
    const letters = ['A', 'B', 'C', null, 'D', 'E', 'F']; 

    const gridContainer = document.getElementById('seat-group');
    const statusBox = document.getElementById('selection-status');
    const displaySpan = document.getElementById('current-seat-text');
    const confirmBtn = document.getElementById('confirm-btn');

    let currentSelectedBtn = null;

    // --- APUFUNKTIOT ---
    function getSeatDetails(row, letter) {
        let type = "Keskipaikka";
        if (letter === 'A' || letter === 'F') type = "Ikkunapaikka";
        if (letter === 'C' || letter === 'D') type = "Käytäväpaikka";
        
        let seatClass = row <= 3 ? "Business-luokka" : "Turistiluokka";
        let isExit = exitRows.includes(row);
        
        return { type, seatClass, isExit };
    }

    // --- GENERATE SEATS ---
    function renderSeats() {
        gridContainer.innerHTML = ''; 

        // Otsikot (A, B, C...)
        const headerCells = ['', 'A', 'B', 'C', '', 'D', 'E', 'F'];
        headerCells.forEach(text => {
            const div = document.createElement('div');
            if (text !== '') {
                div.className = 'grid-header';
                div.textContent = text;
            }
            div.setAttribute('aria-hidden', 'true');
            gridContainer.appendChild(div);
        });

        // Rivit ja paikat
        for (let row = 1; row <= totalRows; row++) {
            
            // Rivinumero
            const rowLabel = document.createElement('div');
            rowLabel.className = 'row-number';
            rowLabel.textContent = row;
            rowLabel.setAttribute('aria-hidden', 'true');
            gridContainer.appendChild(rowLabel);

            letters.forEach((letter) => {
                if (letter === null) {
                    const aisle = document.createElement('div');
                    aisle.className = 'aisle-spacer';
                    aisle.setAttribute('aria-hidden', 'true');
                    gridContainer.appendChild(aisle);
                } else {
                    const seatId = `${row}${letter}`;
                    const isOccupied = occupiedSeats.includes(seatId);
                    const details = getSeatDetails(row, letter);
                    
                    // LUODAAN SUORAAN PAINIKE
                    const btn = document.createElement('button');
                    btn.className = 'seat-btn';
                    btn.dataset.seatId = seatId;
                    // Tallennetaan alkuperäinen kirjain myöhempää käyttöä varten
                    btn.dataset.letter = letter;
                    
                    if (isOccupied) btn.classList.add('occupied');
                    else if (details.isExit) btn.classList.add('exit');
                    else btn.classList.add('available');

                    // --- MUUTOS: KÄYTETÄÄN LEGENDIN SYMBOLEJA ---
                    if (isOccupied) {
                        // Varattu = ✕
                        btn.textContent = '✕';
                    } 
                    else if (details.isExit) {
                        // Hätärivi = ⚠ + kirjain
                        btn.innerHTML = `<span aria-hidden="true">⚠ ${letter}</span>`;
                    } 
                    else {
                        // Vapaa = kirjain
                        btn.textContent = letter;
                    }

                    // ARIA-label: Kaikki oleellinen tieto tässä
                    let ariaLabel = `Paikka ${seatId}, ${details.type}, ${details.seatClass}`;
                    if (details.isExit) ariaLabel += `, Hätäpoistumisrivi`;
                    
                    if (isOccupied) {
                        ariaLabel += `, Varattu`;
                        btn.setAttribute('aria-disabled', 'true');
                        // Varatut paikat eivät ole saavutettavissa Tab-näppäimellä
                        btn.tabIndex = -1;
                    } else {
                        ariaLabel += `, Vapaa`;
                        btn.setAttribute('aria-pressed', 'false');
                        // Painike on saavutettavissa Tab-näppäimellä
                        btn.onclick = () => selectSeat(btn);
                    }
                    
                    btn.setAttribute('aria-label', ariaLabel);
                    gridContainer.appendChild(btn);
                }
            });
        }
    }

    // --- LOGIIKKA ---
    function selectSeat(btn) {
        if (btn.getAttribute('aria-disabled') === 'true') return;

        // Jos meillä on jo valittu paikka, poistetaan valinta siitä
        if (currentSelectedBtn) {
            currentSelectedBtn.classList.remove('selected');
            currentSelectedBtn.classList.add(currentSelectedBtn.dataset.prevClass || 'available');
            currentSelectedBtn.setAttribute('aria-pressed', 'false');
            
            // --- MUUTOS: PALAUTA ALKUPERÄINEN TEKSTI/SYMBOLI ---
            const originalLetter = currentSelectedBtn.dataset.letter;
            const isExit = currentSelectedBtn.classList.contains('exit');
            
            if (isExit) {
                 currentSelectedBtn.innerHTML = `<span aria-hidden="true">⚠ ${originalLetter}</span>`;
            } else {
                 currentSelectedBtn.textContent = originalLetter;
            }

            let label = currentSelectedBtn.getAttribute('aria-label');
            label = label.replace(', Valittu', ', Vapaa');
            currentSelectedBtn.setAttribute('aria-label', label);
        }

        // Asetetaan nykyinen painike
        btn.dataset.prevClass = btn.classList.contains('exit') ? 'exit' : 'available';

        currentSelectedBtn = btn;
        btn.classList.remove('available', 'exit');
        btn.classList.add('selected');
        btn.setAttribute('aria-pressed', 'true');
        
        // --- MUUTOS: VAIHDA TEKSTI RUKSIKSI (✓) ---
        btn.textContent = '✓';
        
        let newLabel = btn.getAttribute('aria-label');
        newLabel = newLabel.replace(', Vapaa', ', Valittu');
        btn.setAttribute('aria-label', newLabel);

        const seatId = btn.dataset.seatId;
        statusBox.textContent = `Valittu paikka ${seatId}.`;
        displaySpan.textContent = seatId;
        confirmBtn.disabled = false;
        
        btn.focus();
    }

    // --- NAVIGOINTI (Nuolinäppäimet) ---
    gridContainer.addEventListener('keydown', (e) => {
        const buttons = Array.from(gridContainer.querySelectorAll('.seat-btn'));
        const active = document.activeElement;
        
        if (!buttons.includes(active)) return;

        const index = buttons.indexOf(active);
        const rowLength = 6; 
        let nextIndex = null;

        switch (e.key) {
            case 'ArrowRight':
                nextIndex = index + 1;
                if (index % rowLength === rowLength - 1) nextIndex = null; 
                break;
            case 'ArrowLeft':
                nextIndex = index - 1;
                if (index % rowLength === 0) nextIndex = null;
                break;
            case 'ArrowDown':
                nextIndex = index + rowLength;
                break;
            case 'ArrowUp':
                nextIndex = index - rowLength;
                break;
            case 'Home':
                nextIndex = Math.floor(index / rowLength) * rowLength;
                break;
            case 'End':
                nextIndex = (Math.floor(index / rowLength) + 1) * rowLength - 1;
                break;
        }

        if (nextIndex !== null && nextIndex >= 0 && nextIndex < buttons.length) {
            e.preventDefault();
            const nextBtn = buttons[nextIndex];
            nextBtn.focus();
        }
    });

    confirmBtn.addEventListener('click', () => {
        if(currentSelectedBtn) {
            alert("Paikka " + currentSelectedBtn.dataset.seatId + " vahvistettu! Hyvää matkaa.");
        }
    });

    renderSeats();

</script>
</body>
</html>